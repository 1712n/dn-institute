<nav>
  {{ partial "docs/brand" . }}
  {{ partial "docs/search" . }}
  {{ if .Site.IsMultiLingual }}
    {{ partial "docs/languages" . }}
  {{ end }}

  {{ partial "docs/inject/menu-before" . }}

  <div class="book-tree">
    <!-- list main sections -->
    {{ range site.Home.Pages }}
      <div class="submenu">
        <h2>
          <a href="{{ .RelPermalink }}">{{ .Title }}</a>
        </h2>
        
        <ul>
          <!-- list sub sections -->
          {{ range .Pages }}
            {{ if eq .Kind "section" }}
              <!-- special case: posts -->
              {{ if eq .Type "posts" }}
                <li class="subsection">
                  <h3>
                    <a href="{{ .RelPermalink }}">{{ .Title }}</a>
                  </h3>

                  <ul>
                    <li>
                      <a href="{{ .RelPermalink }}/all">All</a>
                    </li>
                    <li>
                      <a href="{{ .RelPermalink }}/categories">Categories</a>
                    </li>
                    <li>
                      <a href="{{ .RelPermalink }}/custodians">Custodians</a>
                    </li>
                  </ul>
                </li>

              <!-- other cases -->
              {{ else }}
                <li class="subsection">
                  <h3>
                    <a href="{{ .RelPermalink }}">{{ .Title }}</a>
                  </h3>
                </li>
              {{ end }}
            {{ end }}
          {{ end }}
        </ul>
      </div>
    {{ end }}

    <div class="submenu external-links">
      <h2>External</h2>
      {{ partial "docs/menu-hugo" .Site.Menus.external }}
    </div>
  </div>
    
  {{ partial "docs/inject/menu-after" . }}
</nav>

<!-- Restore menu position as soon as possible to avoid flickering -->
{{ $script := resources.Get "menu-reset.js" | resources.Minify }}
{{ with $script.Content }}
  <script>{{ . | safeJS }}</script>
{{ end }}
